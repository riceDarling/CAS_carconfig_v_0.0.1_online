window.EnvironmentSphericalHarmonics=function(){"use strict";var r=window.P,e=window.OSG,t=e.osg,i=e.osgShader,a=window.$,n=new i.ShaderProcessor,h=function(r){this._uniformSpherical=void 0,Array.isArray(r)&&this.initSHCoef(r),this._file=r};return h.prototype={createShaderSpherical:function(){var r=n.getShader("sphericalHarmonicsVertex.glsl"),e=n.getShader("sphericalHarmonicsFragment.glsl");return new t.Program(new t.Shader("VERTEX_SHADER",r),new t.Shader("FRAGMENT_SHADER",e))},createDebugGeometry:function(){var r=new t.MatrixTransform,e=t.createTexturedSphereGeometry(10,20,20);return e.getOrCreateStateSet().setAttributeAndModes(this.createShaderSpherical()),e.getOrCreateStateSet().addUniform(this._uniformSpherical),r.addChild(e),r},initSHCoef:function(r){this._sphCoef=r.slice(0,27);var e=1/(2*Math.sqrt(Math.PI)),i=-.5*Math.sqrt(3/Math.PI),a=-i,n=i,h=.5*Math.sqrt(15/Math.PI),o=-h,s=.25*Math.sqrt(5/Math.PI),c=o,S=.25*Math.sqrt(15/Math.PI),f=[e,e,e,i,i,i,a,a,a,n,n,n,h,h,h,o,o,o,s,s,s,c,c,c,S,S,S];this._sphCoef=f.map(function(r,e){return r*this._sphCoef[e]}.bind(this)),this._uniformSpherical=t.Uniform.createFloat3Array("uEnvironmentSphericalHarmonics",9),this._uniformSpherical.getInternalArray().set(this._sphCoef)},getUniformSpherical:function(){return this._uniformSpherical},load:function(){if(this._uniformSpherical)return this._uniformSpherical;var e=r(a.get(this._file));return e.then(function(r){var e=JSON.parse(r);this.initSHCoef(e)}.bind(this)),e}},h}();