/*!
QWebEngine 1.01
https://www.auto00.com
https://www.qiland.com
*/
window.EnvironmentCubeMap=function(){"use strict";var e=window.P,t=window.OSG,r=t.osg,a=t.osgDB,i=new t.osgShader.ShaderProcessor,n=function(e,t,r){this._options=r||{},this._size=t,"string"==typeof e?this._file=e:this._data=e};return n.prototype={createTexture:function(e){var t=new r.Texture;return t.setImage(e),t.setMinFilter(this._options.minFilter||"NEAREST"),t.setMagFilter(this._options.magFilter||"NEAREST"),t},createTextureCubemap:function(){var e=new r.TextureCubeMap;e.setMinFilter(this._options.minFilter||"NEAREST"),e.setMagFilter(this._options.magFilter||"NEAREST");for(var t=0;t<6;t++)e.setImage(r.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+t,this._images[t]);return e},createShader:function(e){var t=i.getShader("cubemapVertex.glsl"),a=i.getShader("cubemapFragment.glsl",e);return new r.Program(new r.Shader("VERTEX_SHADER",t),new r.Shader("FRAGMENT_SHADER",a))},createFloatCubeMapDebugGeometry:function(){var e=new r.Node,t=r.createTexturedSphereGeometry(10,20,20);return t.getOrCreateStateSet().setAttributeAndModes(new r.CullFace("DISABLE")),t.getOrCreateStateSet().setTextureAttributeAndModes(0,this._texture),t.getOrCreateStateSet().setAttributeAndModes(this.createShader(["#define FLOAT_CUBEMAP_LOD"])),e.addChild(t),e},deinterleaveImage4:function(e,t,r){for(var a=e*e,i=2*e*e,n=3*e*e,s=0,o=0;o<a;o++)r[s++]=t[o],r[s++]=t[o+a],r[s++]=t[o+i],r[s++]=t[o+n]},deinterleaveImage3:function(e,t,r){for(var a=e*e,i=0,n=0;n<a;n++)r[i++]=t[n],r[i++]=t[n+a],r[i++]=t[n+2*a]},loadPacked:function(t){var i=t;void 0===i&&(i="FLOAT");var n=e.defer(),s=function(e){var t=e;a.isGunzipBuffer(t)&&(t=a.gunzip(t));for(var s=Math.log(this._size)/Math.LN2,o=0,u={},d=0;d<=s;d++){var _,A=Math.pow(2,s-d);if(o>=t.byteLength)break;for(var h=0;h<6;h++){u[r.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+h]||(u[r.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+h]=[]);var E,T;"FLOAT"===i?(_=A*A*4*3,E=new Float32Array(t,o,_/4),T=new Float32Array(_/4),this.deinterleaveImage3(A,E,T)):(_=A*A*4,E=new Uint8Array(t,o,_),T=new Uint8Array(_),this.deinterleaveImage4(A,E,T)),E=T;var g=new r.Image;g.setImage(E),g.setWidth(A),g.setHeight(A),u[r.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+h].push(g),o+=_}}this._packedImages=u,"FLOAT"===i?this.createFloatPacked():this.createRGBA8Packed(),n.resolve()}.bind(this);return this._data?s(this._data):(new a.Input).requestFile(this._file,{responseType:"arraybuffer"}).then(s),n.promise},getTexture:function(){return this._texture},createFloatPacked:function(){var e=new r.TextureCubeMap;e.setMinFilter(this._options.minFilter||"LINEAR_MIPMAP_LINEAR"),e.setMagFilter(this._options.magFilter||"LINEAR"),e.setType("FLOAT"),e.setFlipY(!1);for(var t=0;t<6;t++){var a=r.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+t;e.setImage(a,this._packedImages[a],"RGB")}return this._texture=e,e},createRGBA8Packed:function(){var e=new r.TextureCubeMap;e.setMinFilter("LINEAR_MIPMAP_LINEAR"),e.setMagFilter("LINEAR"),e.setFlipY(!1);for(var t=0;t<6;t++){var a=r.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+t;e.setImage(a,this._packedImages[a],"RGBA")}return this._texture=e,e},createFloatCubeMapPackedDebugGeometry:function(){var e=new r.Node,t=r.createTexturedSphereGeometry(10,20,20);return t.getOrCreateStateSet().setAttributeAndModes(new r.CullFace("DISABLE")),t.getOrCreateStateSet().setTextureAttributeAndModes(0,this._texture),t.getOrCreateStateSet().setAttributeAndModes(this.createShader(["#define FLOAT","#define CUBEMAP_LOD","#define CUBEMAP_SEAMLESS"])),e.addChild(t),e}},n}();