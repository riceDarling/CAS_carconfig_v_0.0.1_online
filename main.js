/*!
QWebEngine 1.0
https://www.auto00.com
https://www.qiland.com
*/var ARCarInfoMainFn=function(){var H=null;var k=window.P;var s=window.OSG;var n=s.osg;var h=s.osgViewer;var m=s.osgDB;var o=s.osgGA;var B=s.osgUtil;var e=s.osgShader;var i=window.$;var f=window.JSZip;var F=window.Object;var u=window.Environment;var v=window.Material;var b={Silver:[0.971519,0.959915,0.915324],Aluminium:[0.913183,0.921494,0.924524],Gold:[1,0.765557,0.336057],Copper:[0.955008,0.637427,0.538163],Chromium:[0.549585,0.556114,0.554256],Nickel:[0.659777,0.608679,0.525649],Titanium:[0.541931,0.496791,0.449419],Cobalt:[0.662124,0.654864,0.633732],Platinum:[0.672411,0.637331,0.585456]};var C={CarBound:{fov:60,eye:[284,-444,-379]},FrontLightBound:{fov:60,eye:[344,121,-476]},BackLightBound:{fov:60,eye:[-297,145,-498]}};var x=function(J){n.NodeVisitor.call(this,n.NodeVisitor.TRAVERSE_ALL_CHILDREN);this._name=J};x.prototype=n.objectInherit(n.NodeVisitor.prototype,{init:function(){this.found=undefined},apply:function(J){if(J.getName()===this._name){this.found=J;return}this.traverse(J)}});var t=function(){};t.prototype={angle:0,direct:-1,startMat:null,startAngle:0,endAngle:0,time:0,curTime:0,tmpMat:null,rotMat:null,starting:false,lastTime:0,setConfig:function(M,J,L,K){this.startMat=M;this.startAngle=J*3.1415926/180;this.endAngle=L*3.1415926/180;this.time=K;this.tmpMat=n.mat4.create();this.rotMat=n.mat4.create()},start:function(J){this.direct=J;this.starting=true;this.lastTime=null},update:function(L,J){if(!this.starting){return}if(this.lastTime==null){this.lastTime=J.getFrameStamp().getSimulationTime()}var K=J.getFrameStamp().getSimulationTime()-this.lastTime;this.lastTime=J.getFrameStamp().getSimulationTime();this.curTime+=this.direct*K;this.rotMat=n.mat4.create();if(this.curTime>this.time){this.starting=false;this.curTime=this.time}else{if(this.curTime<0){this.starting=false;this.curTime=0}}var M=this.curTime/this.time;var O=n.vec3.create();O[0]=this.startMat[12];O[1]=this.startMat[13];O[2]=this.startMat[14];n.mat4.copy(this.tmpMat,this.startMat);this.tmpMat[12]=0;this.tmpMat[13]=0;this.tmpMat[14]=0;var N=M*this.endAngle+(1-M)*this.startAngle;n.mat4.fromRotation(this.rotMat,N,n.vec3.fromValues(0,0,1));n.mat4.mul(this.tmpMat,this.tmpMat,this.rotMat);this.tmpMat[12]+=O[0];this.tmpMat[13]+=O[1];this.tmpMat[14]+=O[2];L.setMatrix(this.tmpMat);console.log("update");return true}};var c=function(){n.NodeVisitor.call(this);this.statesets=[]};c.prototype=n.objectInherit(n.NodeVisitor.prototype,{apply:function(L){var K=L.getStateSet();if(K!=null&&K!=undefined){var J=K.getName();if(J!=null&&J!=undefined){if(this.statesets[J]==null&&this.statesets[J]==undefined){this.statesets[J]=K}}}this.traverse(L)}});var A=function(){o.OrbitManipulator.call(this)};A.prototype=n.objectInherit(o.OrbitManipulator.prototype,{update:(function(){var J=n.vec3.create();return function(M){var N=M.getFrameStamp().getDeltaTime();this.getEyePosition(J);if(this.owner.cameraTarget!=null){n.vec3.lerp(J,J,this.owner.cameraTarget.eye,4*N);if(n.vec3.squaredDistance(J,this.owner.cameraTarget.eye)<0.5){this.owner.cameraTarget=null}}this.setEyePosition(J);var R;var L=0.1;R=this._rotate.update(N);var P=-R[1]*L*this._scaleMouseMotion;if(this.getEyePosition(J)[2]<=this.getTarget(n.vec3.create())[2]&&P<0){P=0}this.computeRotation(-R[0]*L*this._scaleMouseMotion,P);var K=0.002;R=this._pan.update(N);this.computePan(-R[0]*K,-R[1]*K);R=this._zoom.update(N);this.computeZoom(1+R[0]/10);if(this._distance>800){this._distance=800}else{if(this._distance<100){this._distance=100}}this._target=n.vec3.fromValues(0,0,-500);var O=this._target;var Q=this._distance;n.mat4.invert(this._inverseMatrix,this._rotation);n.mat4.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix);n.vec3.set(J,0,Q,0);n.vec3.transformMat4(J,J,this._inverseMatrix);if(J[2]<0){J[2]=0}n.mat4.lookAt(this._inverseMatrix,n.vec3.add(J,O,J),O,this._upz)}})(),});var r=function(){if(navigator.userAgent.match(/Mobile/i)){return true}if(navigator.userAgent.match(/Android/i)){return true}if(navigator.userAgent.match(/iPhone/i)){return true}if(navigator.userAgent.match(/iPad/i)){return true}if(navigator.userAgent.match(/iPod/i)){return true}if(navigator.userAgent.match(/BlackBerry/i)){return true}if(navigator.userAgent.match(/Windows Phone/i)){return true}return false};var D={};(function(L){var Q=[],P;var O=window.location.href.indexOf("?");if(O<0){return}var K=window.location.href.slice(O+1).split("&");for(var N=0;N<K.length;N++){P=K[N].split("=");var M=P[0];Q.push(M);var J=P[1];if(J===undefined){J="1"}L[M]=J}})(D);var y=function(){this._workflow=[];n.NodeVisitor.call(this)};y.prototype=n.objectInherit(n.NodeVisitor.prototype,{apply:function(J){var L=J.getUserData();if(L&&L.pbrWorklow){var K={stateSet:J.getOrCreateStateSet(),workflow:L.pbrWorklow};this._workflow.push(K)}this.traverse(J)},getWorkflows:function(){return this._workflow}});var q=["sphere","model"];var w="textures/parking.zip";var d=w;if(D.env){if(D.env.indexOf("http")!==-1){d=D.env}else{d="textures/"+D.env}}var E=d;var l=[];var j={};var a={};var p=function(){this._config={lightdirect:Math.PI,lod:0.01,carpaintsetting:"#ffffff",environmentType:"cubemapSeamless",brightness:1.2,normalAA:Boolean(D.normalAA===undefined?true:D.normalAA),specularPeak:Boolean(D.specularPeak===undefined?true:D.specularPeak),occlusionHorizon:Boolean(D.occlusionHorizon===undefined?true:D.occlusionHorizon),cameraPreset:D.camera?F.keys(C)[D.camera]:"CameraCenter",roughnesssetting:0.05,material:"Gold",format:"",model:q[0],envsetting:"",mobile:r(),nb:8,offset:1000,metallicsetting:0.12,cameraFov:60};this.updateAlbedo();window.printCurrentCamera=function(){var J=n.vec3.create();var K=n.vec3.create();console.log("target "+this._viewer.getManipulator().getTarget(K).toString());console.log("eye "+this._viewer.getManipulator().getEyePosition(J).toString())}.bind(this)};var G=null;p.prototype={createEnvironment:function(O,N){var M=new u();var J=function(Q){var P=Q.name;j[P]=Q;l.push(P)}.bind(this);if(typeof O==="string"){var K=O;return M.loadPackage(K).then(function(){J(M);return M})}var L=O;return M.readZipContent(L,N).then(function(){J(M);return M})},createModelMaterialSample:function(){this._proxyModel=new n.Node();var J=m.readNodeURL("models/material-test/kl5.osgjs",{progress:function(K){i("body").processbar().setValue(K.loaded/38670085)}});J.then(function(L){var K=new n.MatrixTransform();n.mat4.fromRotation(K.getMatrix(),-Math.PI/2,[1,0,0]);var O=L.getBound();n.mat4.mul(K.getMatrix(),n.mat4.fromTranslation(n.mat4.create(),[0,-O.radius()/2,0]),K.getMatrix());K.addChild(L);this._modelMaterial=K;this._proxyModel.addChild(this._modelMaterial);this._modelMaterial.setNodeMask(0);var N=new B.TangentSpaceGenerator();L.accept(N);var P=new c();L.accept(P);this._proxyModel.statesets=P.statesets;H=new F();H.frDoorAnima=new t();H.brDoorAnima=new t();H.flDoorAnima=new t();H.blDoorAnima=new t();var M=new x("chemen_fr");L.accept(M);H.frDoorAnima.node=M.found;M.found.addUpdateCallback(H.frDoorAnima);H.frDoorAnima.setConfig(M.found.getMatrix(),0,70,0.5);M=new x("chemen_br");L.accept(M);H.brDoorAnima.node=M.found;M.found.addUpdateCallback(H.brDoorAnima);H.brDoorAnima.setConfig(M.found.getMatrix(),0,70,0.5);M=new x("chemen_fl");L.accept(M);H.flDoorAnima.node=M.found;M.found.addUpdateCallback(H.flDoorAnima);H.flDoorAnima.setConfig(M.found.getMatrix(),0,-70,0.5);M=new x("chemen_bl");L.accept(M);H.blDoorAnima.node=M.found;M.found.addUpdateCallback(H.blDoorAnima);H.blDoorAnima.setConfig(M.found.getMatrix(),0,-70,0.5)}.bind(this));return J},updateModel:function(){this._modelMaterial.setNodeMask(0);var J=this._modelMaterial;if(J){J.setNodeMask(~0);J.dirtyBound();this._viewer.getManipulator().computeHomePosition()}},updateRowModelsMetalic:function(){},createSampleModels:function(){var O=[];var P=new v.PbrDefault();G=new v.CarPaint();var K=new v.EnvMaterial();var R=new v.DefaultMaterial();for(var S in this._proxyModel.statesets){var L=null;var N=this._proxyModel.statesets[S];var J=N.getName();console.log("name : "+J);if(J.indexOf("transparent_")==0){L={stateSet:N,material:P,config:{noTangent:true,enableTransparent:true}}}else{if(J.indexOf("control_")==0){L={stateSet:N,material:G,config:{noTangent:true,globalMetalRoughness:true,}}}else{if(J.indexOf("normal_")==0){L={stateSet:N,material:P,config:{noTangent:true,normalMap:true}}}else{if(J.indexOf("env_")==0){L={stateSet:N,material:K,}}else{if(J.indexOf("carPaint_")==0){L={stateSet:N,material:G,config:{noTangent:true}}}else{if(N.getNumTextureAttributeLists()==1||N._binNumber==10){L={stateSet:N,material:R,}}else{L={stateSet:N,material:P,config:{noTangent:true}}}}}}}}O.push(L)}v.createShader(O);var M=new n.MatrixTransform();M.addChild(this._proxyModel);var Q=new n.Node();Q.addChild(M);n.mat4.fromTranslation(M.getMatrix(),[0,130,0]);Q.getOrCreateStateSet().setAttributeAndModes(new n.CullFace());G.setColor(v.convertColor(this._config.carpaintsetting));return Q},createSampleScene:function(){var J=this._mainSceneNode;J.addChild(this.createSampleModels());return J},createScene:function(J){this._mainSceneNode=new n.Node();var K=new n.Node();var M=new n.MatrixTransform();K.addChild(M);this._lod=n.Uniform.createFloat1(0,"uLod");M.getOrCreateStateSet().addUniform(this._lod);var L=[];k.all(L).then(function(){v.preparePbr(K,J);M.addChild(this.createSampleScene());n.mat4.fromRotation(M.getMatrix(),-Math.PI/2,[-1,0,0]);this._viewer.getManipulator().computeHomePosition();this.updateCameraPreset()}.bind(this));return K},createGUI:function(){var K=this._gui;var J;J=K.add(this._config,"cameraPreset",F.keys(C));J.onChange(this.updateCameraPreset.bind(this));J=K.add(this._config,"roughnesssetting",0,1);J.onChange(this.updateRowModelsMetalic.bind(this));J=K.add(this._config,"metallicsetting",0,1);J.onChange(this.updateRowModelsMetalic.bind(this));J=K.addColor(this._config,"carpaintsetting");J.onChange(this.updateAlbedo.bind(this));J=K.add(this._config,"cameraFov",30,100)},run:function(K,J){var P=this._viewer=new h.Viewer(K,{preserveDrawingBuffer:true,premultipliedAlpha:false});P._config=this._config;if(!r()){P.computeCanvasSize=function(V){var X,T;X=V.clientWidth;T=V.clientHeight;if(X<1){X=1}if(T<1){T=1}var R=this._devicePixelRatio;var U=Math.floor(X*R);var S=Math.floor(T*R);var W=false;if(V.width!==2*U){V.width=2*U;this._canvasWidth=U;W=true}if(V.width!==2*S){V.height=2*S;this._canvasHeight=S;W=true}if(W){n.mat4.perspective(P.getCamera().getProjectionMatrix(),Math.PI/180*this._config.cameraFov,V.width/V.height,0.1,1000)}return W};P.setUpView(K,P.initOptions({preserveDrawingBuffer:true,premultipliedAlpha:false}))}P.init();var O=P.getState().getGraphicContext();console.log(O.getSupportedExtensions());console.log(O.getExtension("OES_texture_float"));var M=O.getExtension("OES_texture_float_linear");console.log(M);var Q=O.getExtension("EXT_shader_texture_lod");console.log(Q);var L=[];var N=this.createEnvironment(E);L.push(v.readShaders());L.push(N);v.readAssets(L);L.push(this.createModelMaterialSample());k.all(L).then(function(){J();var R=this.createScene(j[l[0]]);P.setSceneData(R);P.setupManipulator();var S=new A();S.owner=this;P.setManipulator(S);P.getManipulator()._boundStrategy=s.osgGA.Manipulator.COMPUTE_HOME_USING_BBOX;P.getManipulator().computeHomePosition();P.getManipulator().setComputeBoundNodeMaskOverride(0);P.run();n.mat4.perspective(P.getCamera().getProjectionMatrix(),Math.PI/180*this._config.cameraFov,K.width/K.height,0.1,1000);this.updateModel()}.bind(this));return P},updateCameraPreset:function(){var J=C[this._config.cameraPreset];if(!J){J=C[F.keys(C)[0]];n.warn("Camera preset not found, use default")}this.cameraTarget=J},updateAlbedo:function(){},};var I=0;var z=function(K,O,R){if(H==null){return}console.log("mouseMoveLength : "+I);if(I>50||I<-50){return}var Q=K.width/K.clientWidth;var P=K.height/K.clientHeight;var L=O.computeIntersections(R.clientX*Q,(K.clientHeight-R.clientY)*P);var S=O.getManipulator().getEyePosition(n.vec3.create());console.log("hits.length : "+L.length);if(L.length<=0){return}L.sort(function(W,U){var V=n.vec3.squaredLength(n.vec3.sub(n.vec3.create(),W.point,S));var T=n.vec3.squaredLength(n.vec3.sub(n.vec3.create(),U.point,S));return T-V});for(var M=0;M<L.length;M++){var J=L[M];for(var N=0;N<J.nodepath.length;N++){console.log(J.nodepath[N].getName());if(J.nodepath[N]==H.frDoorAnima.node){H.frDoorAnima.direct*=-1;H.frDoorAnima.start(H.frDoorAnima.direct);console.log(J.nodepath[N].getName());return}else{if(J.nodepath[N]==H.flDoorAnima.node){H.flDoorAnima.direct*=-1;H.flDoorAnima.start(H.flDoorAnima.direct);console.log(J.nodepath[N].getName());return}else{if(J.nodepath[N]==H.brDoorAnima.node){H.brDoorAnima.direct*=-1;H.brDoorAnima.start(H.brDoorAnima.direct);console.log(J.nodepath[N].getName());return}else{if(J.nodepath[N]==H.blDoorAnima.node){H.blDoorAnima.direct*=-1;H.blDoorAnima.start(H.blDoorAnima.direct);console.log(J.nodepath[N].getName());return}}}}}}};var g=function(){var J=new p();var K=i("#View")[0];var M=J.run(K,function(){i("body").processbar().hideprocess()});i("body").dataengine().fnquery(function(N){if(N.type=="color"){J._config.carpaintsetting=N.color;J._config.metallicsetting=N.metallic*1;J._config.roughnesssetting=N.roughness*1;G.setColor(v.convertColor(N.color));G.setMetalRoughness(N.metallic*0.2,N.roughness*5)}else{if(N.type=="camera"){J.cameraTarget={};J.cameraTarget.fov=N.fov;J.cameraTarget.eye=N.eye}}});var L={x:0,y:0,sx:0,sy:0};window.example=J;window.addEventListener("mousemove",function(O){var P=O.which||O.button;if(O.altKey&&P){O.stopPropagation();var N=O.clientX-L.x;J._config.lightdirect+=N*0.01;J.updateEnvironmentRotation()}I=O.clientX-L.sx+O.clientY-L.sy;L.x=O.clientX;L.y=O.clientY},true);window.addEventListener("mousedown",function(N){var O=N.which||N.button;I=0;L.sx=N.clientX;L.sy=N.clientY},true);window.addEventListener("click",function(N){z(K,M,N)},true)};g()};ARCarInfoMainFn();